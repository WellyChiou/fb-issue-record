<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­è¨˜å¸³ç³»çµ±</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, setDoc, query, orderBy, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDfHs1XXsCXGMSVF3NFJUtFMcslTzTd-EU",
            authDomain: "expenses-91280.firebaseapp.com",
            projectId: "expenses-91280",
            storageBucket: "expenses-91280.firebasestorage.app",
            messagingSenderId: "777956465315",
            appId: "1:777956465315:web:04f85f2b22f2468eb2fd16",
            measurementId: "G-1LE7YTKHGT"
        };

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // å°‡ Firebase å¯¦ä¾‹è¨­ç‚ºå…¨åŸŸè®Šæ•¸
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseGetDocs = getDocs;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseQuery = query;
        window.firebaseOrderBy = orderBy;
        window.firebaseWhere = where;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseSignInAnonymously = signInAnonymously;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>å®¶åº­è¨˜å¸³ç³»çµ±</h1>
            <div class="summary">
                <div class="summary-item">
                    <span class="label">ç¸½æ”¶å…¥</span>
                    <span class="amount income" id="totalIncome">$0</span>
                </div>
                <div class="summary-item">
                    <span class="label">ç¸½æ”¯å‡º</span>
                    <span class="amount expense" id="totalExpense">$0</span>
                </div>
                <div class="summary-item">
                    <span class="label">ç¾æœ‰è³‡ç”¢</span>
                    <span class="amount asset" id="totalAssets">$0</span>
                </div>
                <div class="summary-item">
                    <span class="label">ç¸½è³‡ç”¢</span>
                    <span class="amount balance" id="totalNetWorth">$0</span>
                </div>
            </div>
            <button class="charts-btn" onclick="expenseTracker.showChartsModal()">ğŸ“Š åœ–è¡¨åˆ†æ</button>
        </header>

        <main>
            <!-- æ–°å¢è¨˜éŒ„å€åŸŸ -->
            <section class="add-record">
                <h2>æ–°å¢è¨˜å¸³è¨˜éŒ„</h2>
                <form id="recordForm">
                    <div class="form-grid">
                    <div class="form-group">
                        <label for="member">å®¶åº­æˆå“¡</label>
                        <select id="member" required>
                            <option value="">è«‹é¸æ“‡æˆå“¡</option>
                            <option value="çˆ¸çˆ¸">çˆ¸çˆ¸</option>
                            <option value="åª½åª½">åª½åª½</option>
                            <option value="å­©å­">å­©å­</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="type">é¡å‹</label>
                        <select id="type" required>
                            <option value="">è«‹é¸æ“‡é¡å‹</option>
                            <option value="æ”¯å‡º">æ”¯å‡º</option>
                            <option value="æ”¶å…¥">æ”¶å…¥</option>
                            <option value="è³‡ç”¢">è³‡ç”¢</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="mainCategory">é¡åˆ¥</label>
                        <select id="mainCategory" required>
                            <option value="">è«‹é¸æ“‡é¡åˆ¥</option>
                            <!-- æ”¯å‡ºå¤§é …ç›® -->
                            <option value="é£Ÿ" data-type="æ”¯å‡º">é£Ÿ</option>
                            <option value="è¡£" data-type="æ”¯å‡º">è¡£</option>
                            <option value="ä½" data-type="æ”¯å‡º">ä½</option>
                            <option value="è¡Œ" data-type="æ”¯å‡º">è¡Œ</option>
                            <option value="è‚²" data-type="æ”¯å‡º">è‚²</option>
                            <option value="æ¨‚" data-type="æ”¯å‡º">æ¨‚</option>
                            <option value="é†«ç™‚" data-type="æ”¯å‡º">é†«ç™‚</option>
                            <option value="å…¶ä»–æ”¯å‡º" data-type="æ”¯å‡º">å…¶ä»–æ”¯å‡º</option>
                            <!-- æ”¶å…¥å¤§é …ç›® -->
                            <option value="è–ªè³‡" data-type="æ”¶å…¥">è–ªè³‡</option>
                            <option value="æŠ•è³‡" data-type="æ”¶å…¥">æŠ•è³‡</option>
                            <!-- è³‡ç”¢å¤§é …ç›® -->
                            <option value="å‹•ç”¢" data-type="è³‡ç”¢">å‹•ç”¢</option>
                            <option value="ä¸å‹•ç”¢" data-type="è³‡ç”¢">ä¸å‹•ç”¢</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="subCategory">ç´°é …</label>
                        <select id="subCategory" required>
                            <option value="">è«‹å…ˆé¸æ“‡é¡åˆ¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="amount">é‡‘é¡</label>
                        <input type="number" id="amount" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">æè¿°</label>
                        <input type="text" id="description" placeholder="è¼¸å…¥æè¿°...">
                    </div>
                    
                    <div class="form-group">
                        <label for="date">æ—¥æœŸ</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit">æ–°å¢è¨˜éŒ„</button>
                        <button type="button" onclick="expenseTracker.resetForm()" class="reset-btn">æ¸…ç©ºè¡¨å–®</button>
                    </div>
                </form>
            </section>


            <!-- è¨˜éŒ„åˆ—è¡¨å€åŸŸ -->
            <section class="records">
                <h2>è¨˜å¸³è¨˜éŒ„</h2>
                <div class="records-list" id="recordsList">
                    <!-- è¨˜éŒ„å°‡å‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <!-- åˆ†é æ§ä»¶ -->
                <div class="pagination" id="pagination">
                    <div class="page-size-selector">
                        <label for="pageSize">æ¯é é¡¯ç¤ºï¼š</label>
                        <select id="pageSize">
                            <option value="5">5 ç­†</option>
                            <option value="10">10 ç­†</option>
                            <option value="20" selected>20 ç­†</option>
                            <option value="50">50 ç­†</option>
                        </select>
                    </div>
                    
                    <div class="page-controls">
                        <button id="prevPage" class="page-btn" disabled>ä¸Šä¸€é </button>
                        <div class="page-info">
                            <span id="pageInfo">ç¬¬ 1 é ï¼Œå…± 1 é </span>
                        </div>
                        <button id="nextPage" class="page-btn" disabled>ä¸‹ä¸€é </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- åœ–è¡¨å½ˆçª— -->
    <div id="chartsModal" class="modal">
        <div class="modal-content charts-modal">
            <div class="modal-header">
                <h2>ğŸ“Š åœ–è¡¨åˆ†æ</h2>
                <span class="close" onclick="expenseTracker.hideChartsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- åœ–è¡¨ç¯©é¸å™¨ -->
                <div class="chart-filters">
                    <h3>åœ–è¡¨ç¯©é¸</h3>
                    <div class="filter-group">
                        <label for="chartFilterType">é¡å‹ï¼š</label>
                        <select id="chartFilterType">
                            <option value="">æ‰€æœ‰é¡å‹</option>
                            <option value="æ”¶å…¥">æ”¶å…¥</option>
                            <option value="æ”¯å‡º">æ”¯å‡º</option>
                            <option value="è³‡ç”¢">è³‡ç”¢</option>
                        </select>
                        
                        <label for="chartFilterYear">å¹´ä»½ï¼š</label>
                        <select id="chartFilterYear">
                            <option value="">æ‰€æœ‰å¹´ä»½</option>
                        </select>
                        
                        <label for="chartFilterMonth">æœˆä»½ï¼š</label>
                        <select id="chartFilterMonth">
                            <option value="">æ‰€æœ‰æœˆä»½</option>
                            <option value="01">1æœˆ</option>
                            <option value="02">2æœˆ</option>
                            <option value="03">3æœˆ</option>
                            <option value="04">4æœˆ</option>
                            <option value="05">5æœˆ</option>
                            <option value="06">6æœˆ</option>
                            <option value="07">7æœˆ</option>
                            <option value="08">8æœˆ</option>
                            <option value="09">9æœˆ</option>
                            <option value="10">10æœˆ</option>
                            <option value="11">11æœˆ</option>
                            <option value="12">12æœˆ</option>
                        </select>
                    </div>
                </div>
                
                <h2 class="expense-section-title">æ”¯å‡ºçµ±è¨ˆ</h2>
                <div class="chart-row expense-section">
                    <div class="chart-container">
                        <h3>æ”¯å‡ºé¡åˆ¥åˆ†å¸ƒ</h3>
                        <canvas id="expenseCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>å®¶åº­æˆå“¡æ”¯å‡ºåˆ†å¸ƒ</h3>
                        <canvas id="expenseMemberChart"></canvas>
                    </div>
                </div>
                
                <h2 class="income-section-title">æ”¶å…¥çµ±è¨ˆ</h2>
                <div class="chart-row income-section">
                    <div class="chart-container">
                        <h3>æ”¶å…¥é¡åˆ¥åˆ†å¸ƒ</h3>
                        <canvas id="incomeCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>å®¶åº­æˆå“¡æ”¶å…¥åˆ†å¸ƒ</h3>
                        <canvas id="incomeMemberChart"></canvas>
                    </div>
                </div>
                
                <h2 class="asset-section-title">è³‡ç”¢çµ±è¨ˆ</h2>
                <div class="chart-row asset-section">
                    <div class="chart-container">
                        <h3>è³‡ç”¢é¡åˆ¥åˆ†å¸ƒ</h3>
                        <canvas id="assetCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>å®¶åº­æˆå“¡è³‡ç”¢åˆ†å¸ƒ</h3>
                        <canvas id="assetMemberChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="expenseTracker.hideChartsModal()">é—œé–‰</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
