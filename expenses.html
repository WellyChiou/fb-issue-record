<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家庭記帳系統</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, setDoc, query, orderBy, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyDfHs1XXsCXGMSVF3NFJUtFMcslTzTd-EU",
            authDomain: "expenses-91280.firebaseapp.com",
            projectId: "expenses-91280",
            storageBucket: "expenses-91280.firebasestorage.app",
            messagingSenderId: "777956465315",
            appId: "1:777956465315:web:04f85f2b22f2468eb2fd16",
            measurementId: "G-1LE7YTKHGT"
        };

        // 初始化 Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 將 Firebase 實例設為全域變數
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseGetDocs = getDocs;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseQuery = query;
        window.firebaseOrderBy = orderBy;
        window.firebaseWhere = where;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseSignInAnonymously = signInAnonymously;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>家庭記帳系統</h1>
            <div class="summary">
                <div class="summary-item">
                    <span class="label">總收入</span>
                    <span class="amount income" id="totalIncome">$0</span>
                </div>
                <div class="summary-item">
                    <span class="label">總支出</span>
                    <span class="amount expense" id="totalExpense">$0</span>
                </div>
                <div class="summary-item">
                    <span class="label">現有資產</span>
                    <span class="amount asset" id="totalAssets">$0</span>
                </div>
                <div class="summary-item">
                    <span class="label">總資產</span>
                    <span class="amount balance" id="totalNetWorth">$0</span>
                </div>
            </div>
            <button class="charts-btn" onclick="expenseTracker.showChartsModal()">📊 圖表分析</button>
        </header>

        <main>
            <!-- 新增記錄區域 -->
            <section class="add-record">
                <h2>新增記帳記錄</h2>
                <form id="recordForm">
                    <div class="form-grid">
                    <div class="form-group">
                        <label for="member">家庭成員</label>
                        <select id="member" required>
                            <option value="">請選擇成員</option>
                            <option value="爸爸">爸爸</option>
                            <option value="媽媽">媽媽</option>
                            <option value="孩子">孩子</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="type">類型</label>
                        <select id="type" required>
                            <option value="">請選擇類型</option>
                            <option value="支出">支出</option>
                            <option value="收入">收入</option>
                            <option value="資產">資產</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="mainCategory">類別</label>
                        <select id="mainCategory" required>
                            <option value="">請選擇類別</option>
                            <!-- 支出大項目 -->
                            <option value="食" data-type="支出">食</option>
                            <option value="衣" data-type="支出">衣</option>
                            <option value="住" data-type="支出">住</option>
                            <option value="行" data-type="支出">行</option>
                            <option value="育" data-type="支出">育</option>
                            <option value="樂" data-type="支出">樂</option>
                            <option value="醫療" data-type="支出">醫療</option>
                            <option value="其他支出" data-type="支出">其他支出</option>
                            <!-- 收入大項目 -->
                            <option value="薪資" data-type="收入">薪資</option>
                            <option value="投資" data-type="收入">投資</option>
                            <!-- 資產大項目 -->
                            <option value="動產" data-type="資產">動產</option>
                            <option value="不動產" data-type="資產">不動產</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="subCategory">細項</label>
                        <select id="subCategory" required>
                            <option value="">請先選擇類別</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="amount">金額</label>
                        <input type="number" id="amount" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">描述</label>
                        <input type="text" id="description" placeholder="輸入描述...">
                    </div>
                    
                    <div class="form-group">
                        <label for="date">日期</label>
                        <input type="date" id="date" required>
                    </div>
                    
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit">新增記錄</button>
                        <button type="button" onclick="expenseTracker.resetForm()" class="reset-btn">清空表單</button>
                    </div>
                </form>
            </section>


            <!-- 記錄列表區域 -->
            <section class="records">
                <h2>記帳記錄</h2>
                <div class="records-list" id="recordsList">
                    <!-- 記錄將動態生成 -->
                </div>
                
                <!-- 分頁控件 -->
                <div class="pagination" id="pagination">
                    <div class="page-size-selector">
                        <label for="pageSize">每頁顯示：</label>
                        <select id="pageSize">
                            <option value="5">5 筆</option>
                            <option value="10">10 筆</option>
                            <option value="20" selected>20 筆</option>
                            <option value="50">50 筆</option>
                        </select>
                    </div>
                    
                    <div class="page-controls">
                        <button id="prevPage" class="page-btn" disabled>上一頁</button>
                        <div class="page-info">
                            <span id="pageInfo">第 1 頁，共 1 頁</span>
                        </div>
                        <button id="nextPage" class="page-btn" disabled>下一頁</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 圖表彈窗 -->
    <div id="chartsModal" class="modal">
        <div class="modal-content charts-modal">
            <div class="modal-header">
                <h2>📊 圖表分析</h2>
                <span class="close" onclick="expenseTracker.hideChartsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- 圖表篩選器 -->
                <div class="chart-filters">
                    <h3>圖表篩選</h3>
                    <div class="filter-group">
                        <label for="chartFilterType">類型：</label>
                        <select id="chartFilterType">
                            <option value="">所有類型</option>
                            <option value="收入">收入</option>
                            <option value="支出">支出</option>
                            <option value="資產">資產</option>
                        </select>
                        
                        <label for="chartFilterYear">年份：</label>
                        <select id="chartFilterYear">
                            <option value="">所有年份</option>
                        </select>
                        
                        <label for="chartFilterMonth">月份：</label>
                        <select id="chartFilterMonth">
                            <option value="">所有月份</option>
                            <option value="01">1月</option>
                            <option value="02">2月</option>
                            <option value="03">3月</option>
                            <option value="04">4月</option>
                            <option value="05">5月</option>
                            <option value="06">6月</option>
                            <option value="07">7月</option>
                            <option value="08">8月</option>
                            <option value="09">9月</option>
                            <option value="10">10月</option>
                            <option value="11">11月</option>
                            <option value="12">12月</option>
                        </select>
                    </div>
                </div>
                
                <h2 class="expense-section-title">支出統計</h2>
                <div class="chart-row expense-section">
                    <div class="chart-container">
                        <h3>支出類別分布</h3>
                        <canvas id="expenseCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>家庭成員支出分布</h3>
                        <canvas id="expenseMemberChart"></canvas>
                    </div>
                </div>
                
                <h2 class="income-section-title">收入統計</h2>
                <div class="chart-row income-section">
                    <div class="chart-container">
                        <h3>收入類別分布</h3>
                        <canvas id="incomeCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>家庭成員收入分布</h3>
                        <canvas id="incomeMemberChart"></canvas>
                    </div>
                </div>
                
                <h2 class="asset-section-title">資產統計</h2>
                <div class="chart-row asset-section">
                    <div class="chart-container">
                        <h3>資產類別分布</h3>
                        <canvas id="assetCategoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>家庭成員資產分布</h3>
                        <canvas id="assetMemberChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="expenseTracker.hideChartsModal()">關閉</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
